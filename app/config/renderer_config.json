{
	"name" : "Default",
	"uniformBuffers" : [
		{
			"name" : "PerInstanceDataPreCombine",
			"entries" : [
				"InverseProjectionMatrix",
				"InverseViewProjectionMatrix",
				"CameraWorldPosition"
			]
		},
		{
			"name" : "PerInstanceDataPostCombine",
			"entries" : [
				"HaltonSamples"
			]
		},
		{
			"name" : "Dummy",
			"entries" : [
				"CameraWorldPosition"
			]
		}
	],
	"images" : [
		{
			"name" : "GBufferDepth",
			"renderSize" : "Full",
			"imageFormat" : "Depth"
		},
		{
			"name" : "GBufferAlbedo",
			"renderSize" : "Full",
			"imageFormat" : "R16G16B16A16Float"
		},
		{
			"name" : "GBufferNormal",
			"renderSize" : "Full",
			"imageFormat" : "R16G16B16A16Float"
		},
		{
			"name" : "GBufferParameter0",
			"renderSize" : "Full",
			"imageFormat" : "R16G16B16A16Float"
		},
		{
			"name" : "GBufferTransparentsAlbedo",
			"renderSize" : "Full",
			"imageFormat" : "R16G16B16A16Float"
		},
		{
			"name" : "GBufferTransparentsNormal",
			"renderSize" : "Full",
			"imageFormat" : "R16G16B16A16Float"
		},
		{
			"name" : "GBufferTransparentsParameter0",
			"renderSize" : "Full",
			"imageFormat" : "R16G16B16A16Float"
		},
		{
			"name" : "GBufferTransparentsDepth",
			"renderSize" : "Full",
			"imageFormat" : "Depth"
		},
		{
			"name" : "Scene",
			"renderSize" : "Full",
			"imageFormat" : "B10G11R11UFloat"
		},
		{
			"name" : "SceneDownSampled",
			"renderSize" : "Half",
			"imageFormat" : "B10G11R11UFloat"
		},
		{
			"name" : "LensFlare",
			"renderSize" : "Quarter",
			"imageFormat" : "B10G11R11UFloat"
		},
		{
			"name" : "LensFlarePingPong",
			"renderSize" : "Quarter",
			"imageFormat" : "B10G11R11UFloat"
		},
		{
			"name" : "SceneBlurred",
			"renderSize" : "Half",
			"imageFormat" : "B10G11R11UFloat"
		},
		{
			"name" : "SceneBlurredPingPong",
			"renderSize" : "Half",
			"imageFormat" : "B10G11R11UFloat"
		}
	],

	"renderSteps" : [
		// Offscreen test
		{
			"type" : "SwitchCamera",
			"cameraName" : "GameCamera"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferDepth",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "DepthStencilAttachment"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "Scene",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "RenderPassGenericMesh",
			"name" : "GBuffer",
			"materialPasses" : ["GBufferDefault", "GBufferLayered"],
			"renderOrder" : "FrontToBack",
			"outputs" : [
				["Scene", [0.4, 0.4, 1.0, 1.0]],
				["GBufferDepth", [1.0, 0.0, 0.0, 0.0]]
			]
		},
		{
			"type" : "RenderPassGenericMesh",
			"name" : "GBufferFoliage",
			"materialPasses" : ["GBufferFoliage"],
			"renderOrder" : "FrontToBack",
			"outputs" : [
				["Scene"],
				["GBufferDepth"]
			]
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "Scene",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		// <-
		// GBuffer passes
		// ->
		{
			"type" : "SwitchCamera",
			"cameraName" : "ActiveCamera"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferAlbedo",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferNormal",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferParameter0",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "RenderPassGenericMesh",
			"name" : "GBufferPrePassFoliage",
			"materialPasses" : ["GBufferFoliagePrePass"],
			"renderOrder" : "FrontToBack",
			"outputs" : [
				["GBufferDepth", [1.0]]
			]
		},
		{
			"type" : "RenderPassGenericMesh",
			"name" : "GBuffer",
			"materialPasses" : ["GBufferDefault", "GBufferLayered", "GBufferFoliage"],
			"renderOrder" : "FrontToBack",
			"outputs" : [
				["GBufferAlbedo", [0.1, 0.5, 1.0, 1.0]],
				["GBufferNormal", [0.0, 0.0, 0.0, 0.0]],
				["GBufferParameter0", [0.0, 0.0, 0.0, 0.0]],
				["GBufferDepth"]
			]
		},
		{
			"type" : "RenderPassGenericMesh",
			"name" : "GBufferSky",
			"materialPasses" : ["GBufferSky"],
			"renderOrder" : "BackToFront",
			"outputs" : [
				["GBufferAlbedo"],
				["GBufferDepth"]
			]
		},
		{
			"type" : "RenderPassDebug"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferAlbedo",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferNormal",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferParameter0",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferDepth",
			"sourceImageLayout" : "DepthStencilAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsAlbedo",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsNormal",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsParameter0",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsDepth",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "DepthStencilAttachment"
		},
		{
			"type" : "RenderPassGenericMesh",
			"name" : "GBufferTransparents",
			"materialPasses" : ["GBufferWater", "GBufferEffect"],
			"renderOrder" : "BackToFront",
			"outputs" : [
				["GBufferTransparentsAlbedo", [0.0, 0.0, 0.0, 1.0]],
				["GBufferTransparentsNormal", [0.0, 0.0, 0.0, 0.0]],
				["GBufferTransparentsParameter0", [0.0, 0.0, 0.0, 0.0]],
				["GBufferTransparentsDepth", [1.0]]
			]
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsAlbedo",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsNormal",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsParameter0",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "GBufferTransparentsDepth",
			"sourceImageLayout" : "DepthStencilAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		// <-
		{
			"type" : "RenderPassPerPixelPicking"
		},
		// Lighting passes
		// ->
		{
			"type" : "RenderPassShadow"
		},
		{
			"type" : "RenderPassLighting"
		},
		{
			"type" : "RenderPassVolumetricLighting"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "Scene",
			"sourceImageLayout" : "ShaderReadOnly",
			"targetImageLayout" : "ColorAttachment"
		},
		// <-
		// Post processing
		// ->
		{
			"type" : "RenderPassGenericFullscreen",
			"name" : "PreCombine",
			"fragmentGpuProgram" : "pre_combine.frag",
			"viewportRenderSize" : "Full",
			"perInstanceDataBufferName" : "PerInstanceDataPreCombine",
			"inputs" : [
				["Image", "GBufferAlbedo", "albedoTex", "Fragment", "NearestClamp"],
				["Image", "GBufferNormal", "normalTex", "Fragment", "NearestClamp"],
				["Image", "GBufferParameter0", "param0Tex", "Fragment", "NearestClamp"],
				["Image", "GBufferTransparentsAlbedo", "albedoTransparentsTex", "Fragment", "NearestClamp"],
				["Image", "GBufferTransparentsNormal", "normalTransparentsTex", "Fragment", "NearestClamp"],
				["Image", "GBufferTransparentsParameter0", "param0TransparentsTex", "Fragment", "NearestClamp"],
				["Image", "LightBuffer", "lightBufferTex", "Fragment", "NearestClamp"],
				["Image", "LightBufferTransparents", "lightBufferTransparentsTex", "Fragment", "NearestClamp"],
				["Image", "GBufferDepth", "depthBufferTex", "Fragment", "NearestClamp"],
				["Image", "GBufferTransparentsDepth", "depthBufferTransparentsTex", "Fragment", "NearestClamp"],
				["Buffer", "MaterialBuffer", "MaterialBuffer", "Fragment"],
				["Image", "VolumetricLightingScatteringBuffer", "volumetricLightingScatteringBufferTex", "Fragment", "LinearClamp"]
			],
			"outputs" : [
				["Scene"]
			]
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "Scene",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "SceneDownSampled",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "RenderPassGenericFullscreen",
			"name" : "DownSampleScene",
			"fragmentGpuProgram" : "blit.frag",
			"viewportRenderSize" : "Half",
			"perInstanceDataBufferName" : "Dummy",
			"inputs" : [
				["Image", "Scene", "inputTex", "Fragment", "LinearClamp"]
			],
			"outputs" : [
				["SceneDownSampled"]
			]
		},
		{
			"type" : "RenderPassBloom"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "LensFlare",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "RenderPassGenericFullscreen",
			"name" : "LensFlare",
			"fragmentGpuProgram" : "lens_flare.frag",
			"viewportRenderSize" : "Quarter",
			"perInstanceDataBufferName" : "Dummy",
			"inputs" : [
				["Image", "BloomBright", "brightnessTex", "Fragment", "LinearClamp"],
				["Image", "lens_flare", "lensFlareTex", "Fragment", "LinearClamp"]
			],
			"outputs" : [
				["LensFlare"]
			]
		},
		{
			"type" : "RenderPassGenericBlur",
			"name" : "BlurLensFlares",
			"sourceImage" : "LensFlare",
			"pingPongImage" : "LensFlarePingPong",
			"targetImage" : "LensFlare",
			"outputs" : [
			]
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "LensFlare",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "SceneBlurred",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "SceneBlurredPingPong",
			"sourceImageLayout" : "Undefined",
			"targetImageLayout" : "ColorAttachment"
		},
		// Generate blurred half res. scene image
		{
			"type" : "RenderPassGenericBlur",
			"name" : "BlurScene",
			"sourceImage" : "SceneDownSampled",
			"pingPongImage" : "SceneBlurredPingPong",
			"targetImage" : "SceneBlurred",
			"outputs" : [
			]
		},
		{
			"type" : "ImageMemoryBarrier",
			"image" : "SceneBlurred",
			"sourceImageLayout" : "ColorAttachment",
			"targetImageLayout" : "ShaderReadOnly"
		},
		{
			"type" : "RenderPassGenericFullscreen",
			"name" : "PostCombine",
			"fragmentGpuProgram" : "post_combine.frag",
			"viewportRenderSize" : "Full",
			"perInstanceDataBufferName" : "PerInstanceDataPostCombine",
			"inputs" : [
				["Image", "Scene", "sceneTex", "Fragment", "NearestClamp"],
				["Image", "SceneBlurred", "sceneBlurredTex", "Fragment", "LinearClamp"],
				["Image", "BloomSummed", "bloomTex", "Fragment", "LinearClamp"],
				["Image", "lens_dirt", "lensDirtTex", "Fragment", "NearestClamp"],
				["Image", "film_grain_noise", "filmGrainTex", "Fragment", "NearestClamp"],
				["Image", "LensFlare", "lensFlareTex", "Fragment", "LinearClamp"],
				["Image", "GBufferDepth", "depthBufferTex", "Fragment", "NearestClamp"],
				["Buffer", "BloomLumBuffer", "AvgLum", "Fragment"]
			],
			"outputs" : [
				["Backbuffer"]
			]
		}
		// <-
	]
}
